# ğŸŒ Internationalization (i18n) Guide

This guide explains how to use the internationalization features in the K3T Next.js Boilerplate. The boilerplate comes with complete i18n support built on Next.js 15 App Router.

## ğŸ“‹ Table of Contents

- [Overview](#overview)
- [Supported Languages](#supported-languages)
- [Project Structure](#project-structure)
- [Getting Started](#getting-started)
- [Adding Translations](#adding-translations)
- [Client-Side Navigation](#client-side-navigation)
- [Server-Side Usage](#server-side-usage)
- [Adding New Languages](#adding-new-languages)
- [URL Structure](#url-structure)
- [Best Practices](#best-practices)
- [Troubleshooting](#troubleshooting)

## ğŸŒ Overview

The boilerplate includes a complete internationalization system with:

- **Automatic locale detection** from browser preferences
- **SEO-friendly URLs** with locale prefixes
- **Server-side rendering** with proper locale handling
- **Type-safe translations** with TypeScript support
- **Zero-config setup** - works out of the box

### Key Features

- âœ… Automatic browser language detection
- âœ… SEO-optimized localized URLs
- âœ… Server-side translation loading
- âœ… Client-side locale switching
- âœ… Fallback locale support
- âœ… Type-safe translation system
- âœ… Performance optimized with server-only imports

## ğŸŒ Supported Languages

The boilerplate currently supports three languages:

| Language          | Code | Example URL  |
| ----------------- | ---- | ------------ |
| English (Default) | `en` | `/en/about`  |
| Portuguese        | `pt` | `/pt/sobre`  |
| Spanish           | `es` | `/es/acerca` |

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ [lang]/              # Dynamic locale routes
â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Localized layout
â”‚   â”‚   â””â”€â”€ page.tsx         # Localized pages
â”‚   â”œâ”€â”€ layout.tsx           # Root layout (redirects)
â”‚   â”œâ”€â”€ page.tsx             # Root page (redirects)
â”‚   â””â”€â”€ not-found.jsx        # 404 fallback
â”œâ”€â”€ dictionaries/            # Translation files
â”‚   â”œâ”€â”€ en.json             # English translations
â”‚   â”œâ”€â”€ pt.json             # Portuguese translations
â”‚   â””â”€â”€ es.json             # Spanish translations
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ usePathname.ts      # Navigation hook
â”œâ”€â”€ lib/i18n/
â”‚   â”œâ”€â”€ get-dictionary.ts   # Translation loader
â”‚   â””â”€â”€ i18n-config.ts      # i18n configuration
â””â”€â”€ middleware.ts           # Locale detection middleware
```

## ğŸš€ Getting Started

### 1. Understanding the URL Structure

When users visit your site, they'll be automatically redirected to their preferred locale:

```
/ â†’ /en (or user's browser language)
/about â†’ /en/about
/contact â†’ /pt/contact (if user prefers Portuguese)
```

### 2. Basic Page Implementation

Create a page that uses translations:

```typescript
// src/app/[lang]/about/page.tsx
import { getDictionary } from '@/lib/i18n/get-dictionary'
import { Locale } from '@/lib/i18n/i18n-config'

export default async function AboutPage(props: {
  params: Promise<{ lang: Locale }>
}) {
  const { lang } = await props.params
  const t = await getDictionary(lang)

  return (
    <div>
      <h1>{t.AboutPage.title}</h1>
      <p>{t.AboutPage.description}</p>
    </div>
  )
}
```

### 3. Layout Implementation

The layout automatically receives the locale parameter:

```typescript
// src/app/[lang]/layout.tsx
import { Locale } from '@/lib/i18n/i18n-config'

export default async function RootLayout(props: {
  children: React.ReactNode
  params: Promise<{ lang: Locale }>
}) {
  const params = await props.params
  const { children } = props

  return (
    <html lang={params.lang}>
      <body>{children}</body>
    </html>
  )
}
```

## ğŸ“ Adding Translations

### 1. Add Translation Keys

Update your translation files with new content:

```json
// src/dictionaries/en.json
{
  "HomePage": {
    "title": "Welcome to Kode3 Tech",
    "description": "Building innovative solutions"
  },
  "AboutPage": {
    "title": "About Us",
    "description": "Learn more about our company"
  },
  "Navigation": {
    "home": "Home",
    "about": "About",
    "contact": "Contact"
  }
}
```

```json
// src/dictionaries/pt.json
{
  "HomePage": {
    "title": "Bem-vindo Ã  Kode3 Tech",
    "description": "Construindo soluÃ§Ãµes inovadoras"
  },
  "AboutPage": {
    "title": "Sobre NÃ³s",
    "description": "Saiba mais sobre nossa empresa"
  },
  "Navigation": {
    "home": "InÃ­cio",
    "about": "Sobre",
    "contact": "Contato"
  }
}
```

### 2. Using Nested Translation Keys

You can organize translations hierarchically:

```json
{
  "Common": {
    "buttons": {
      "save": "Save",
      "cancel": "Cancel",
      "submit": "Submit"
    },
    "messages": {
      "success": "Operation completed successfully",
      "error": "An error occurred"
    }
  }
}
```

```typescript
// Usage in component
const t = await getDictionary(lang)
console.log(t.Common.buttons.save) // "Save"
```

## ğŸ§­ Client-Side Navigation

### Using the usePathname Hook

For client-side navigation with locale support:

```typescript
'use client'
import { usePathname } from '@/hooks/usePathname'

export default function LanguageSwitcher() {
  const { pathname, redirectWithLocale } = usePathname()

  const switchToPortuguese = () => {
    redirectWithLocale('pt') // Keeps current path, changes locale
  }

  const goToAbout = () => {
    redirectWithLocale('en', '/about') // Goes to specific path with locale
  }

  return (
    <div>
      <p>Current path: {pathname}</p>
      <button onClick={switchToPortuguese}>
        Switch to Portuguese
      </button>
      <button onClick={goToAbout}>
        Go to About (English)
      </button>
    </div>
  )
}
```

### Navigation Component Example

```typescript
'use client'
import { usePathname } from '@/hooks/usePathname'

const languages = [
  { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
  { code: 'pt', name: 'PortuguÃªs', flag: 'ğŸ‡§ğŸ‡·' },
  { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' }
]

export default function LanguageSelector() {
  const { redirectWithLocale } = usePathname()

  return (
    <select
      onChange={(e) => redirectWithLocale(e.target.value)}
      className="px-3 py-1 border rounded"
    >
      {languages.map((lang) => (
        <option key={lang.code} value={lang.code}>
          {lang.flag} {lang.name}
        </option>
      ))}
    </select>
  )
}
```

## ğŸ–¥ï¸ Server-Side Usage

### In Server Components

```typescript
// Always use getDictionary in server components
import { getDictionary } from '@/lib/i18n/get-dictionary'
import { Locale } from '@/lib/i18n/i18n-config'

export default async function ServerComponent(props: {
  params: Promise<{ lang: Locale }>
}) {
  const { lang } = await props.params
  const t = await getDictionary(lang)

  return (
    <div>
      <h1>{t.HomePage.title}</h1>
      <p>{t.HomePage.description}</p>
    </div>
  )
}
```

### In API Routes

```typescript
// src/app/api/example/route.ts
import { NextRequest } from 'next/server'
import { getDictionary } from '@/lib/i18n/get-dictionary'

export async function GET(request: NextRequest) {
  const locale = request.headers.get('accept-language') || 'en'
  const t = await getDictionary(locale as any)

  return Response.json({
    message: t.API.welcome
  })
}
```

## ğŸ†• Adding New Languages

### 1. Create Translation File

```bash
# Create new translation file
touch src/dictionaries/fr.json
```

```json
// src/dictionaries/fr.json
{
  "HomePage": {
    "title": "Bienvenue chez Kode3 Tech",
    "description": "Construire des solutions innovantes"
  }
}
```

### 2. Update i18n Configuration

```typescript
// src/lib/i18n/i18n-config.ts
export const i18n = {
  defaultLocale: 'en',
  locales: ['en', 'pt', 'es', 'fr'] // Add 'fr'
} as const
```

### 3. Update Dictionary Loader

```typescript
// src/lib/i18n/get-dictionary.ts
const dictionaries = {
  en: () =>
    import('../../dictionaries/en.json').then((module) => module.default),
  pt: () =>
    import('../../dictionaries/pt.json').then((module) => module.default),
  es: () =>
    import('../../dictionaries/es.json').then((module) => module.default),
  fr: () =>
    import('../../dictionaries/fr.json').then((module) => module.default) // Add this
}
```

### 4. Test the New Language

Visit `/fr` to test the new French locale.

## ğŸ”— URL Structure

### URL Patterns

```
/                    â†’ Redirects to /en (or user's preferred locale)
/en                  â†’ English homepage
/en/about            â†’ English about page
/pt                  â†’ Portuguese homepage
/pt/sobre            â†’ Portuguese about page
/es                  â†’ Spanish homepage
/es/acerca           â†’ Spanish about page
/unknown             â†’ 404 page
```

### SEO Benefits

- Each locale has its own URL structure
- Search engines can index language-specific content
- Users can bookmark localized pages
- Social media shares preserve language context

## âœ… Best Practices

### 1. Translation Key Naming

Use consistent, hierarchical naming:

```json
{
  "ComponentName": {
    "element": "Translation",
    "nested": {
      "deep": "Deep translation"
    }
  }
}
```

### 2. Fallback Content

Always provide fallback content for missing translations:

```typescript
const title = t.HomePage?.title || 'Default Title'
```

### 3. Performance Optimization

- Use server-only imports for dictionaries
- Load only needed translations per page
- Consider splitting large translation files

### 4. Testing Translations

Test your translations across all supported locales:

```bash
# Test each locale
npm run dev

# Visit:
# http://localhost:3000/en
# http://localhost:3000/pt
# http://localhost:3000/es
```

### 5. Dynamic Content

For dynamic content, consider using interpolation:

```json
{
  "welcome": "Welcome, {{name}}!"
}
```

```typescript
// Implement interpolation helper
function interpolate(template: string, values: Record<string, string>) {
  return template.replace(
    /\{\{(\w+)\}\}/g,
    (match, key) => values[key] || match
  )
}

// Usage
const message = interpolate(t.welcome, { name: 'John' })
```

## ğŸ› Troubleshooting

### Common Issues

#### 1. Locale not detected

**Problem**: Users not redirected to correct locale
**Solution**: Check browser Accept-Language headers

```typescript
// Debug in middleware
console.log('Headers:', request.headers.get('accept-language'))
```

#### 2. Translation not found

**Problem**: Translation key returns undefined
**Solution**: Check key exists in all language files

```typescript
// Add debugging
const t = await getDictionary(lang)
console.log('Loaded translations:', Object.keys(t))
```

#### 3. TypeScript errors

**Problem**: TypeScript complaining about translation types
**Solution**: Ensure all translation files have same structure

#### 4. Middleware not working

**Problem**: Redirects not happening
**Solution**: Check middleware matcher configuration

```typescript
// src/middleware.ts
export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico|.*\\.[a-zA-Z]+$).*)']
}
```

### Debug Mode

Enable debug mode to troubleshoot issues:

```typescript
// src/middleware.ts
export function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname
  console.log('ğŸ” Middleware Debug:', {
    pathname,
    locale: getLocale(request),
    acceptLanguage: request.headers.get('accept-language')
  })
  // ... rest of middleware
}
```

### Testing Locale Detection

Test with different Accept-Language headers:

```bash
# Test Portuguese preference
curl -H "Accept-Language: pt-BR,pt;q=0.9,en;q=0.8" http://localhost:3000/

# Test Spanish preference
curl -H "Accept-Language: es-ES,es;q=0.9,en;q=0.8" http://localhost:3000/
```

## ğŸš€ Next Steps

### Advanced Features to Implement

1. **Date/Time Localization**

   ```typescript
   const formatDate = (date: Date, locale: string) => {
     return new Intl.DateTimeFormat(locale).format(date)
   }
   ```

2. **Number Formatting**

   ```typescript
   const formatCurrency = (amount: number, locale: string) => {
     return new Intl.NumberFormat(locale, {
       style: 'currency',
       currency: locale === 'pt' ? 'BRL' : 'USD'
     }).format(amount)
   }
   ```

3. **Pluralization**
   Consider using libraries like `react-i18next` for complex pluralization rules.

4. **Context-Aware Translations**
   Implement context-based translations for better accuracy.

---

## ğŸ“š Additional Resources

- [Next.js Internationalization Docs](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [MDN Intl Documentation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [Accept-Language Header Specification](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language)
- [Semantic Versioning](https://semver.org/)

---

**Need help?** Open an issue on our [GitHub repository](https://github.com/kode3tech/k3t-nextjs-boilerplate) or check the troubleshooting section above.
